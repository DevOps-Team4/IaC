{
  "project": {
    "name": " ",
    "environment": "dev",
    "region": "europe-west3",
    "os_image": "ubuntu-2204-lts",
    "terraform_username": "terraform-user",
    "ssh_public_keys": [
      "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQClN07uAu8iOr5e1jWcCkI3hLj1RoVsRvCSS4ffzuprTITZZrgdHKwSrPy0oluU7H2oYpriQNfOhnFxChWU4q0uoFdLr+NxV4MiCyugt6wXIfXhgLWdRepOZjjYzm/Q/+WVYspUH7SqR8OsIgXMohGj2OQHqI9JZ/ipQKYI5EPDhRziFCosmx69CW2TmRnDG9MrbEEzb1DNKYD4+zjxfPwjb8kIRTyb6IWIC0ihObqYsCAKtR94s3Pcom2dOXJNrq1bHgLDFAbZaV1yKEw0O+8hoM63nRVZrlE+VtnsKFI/9//elmPPQXcPu6m24SoEZMFpxCglOmaT+HQmFy2V6/OrxgeNBAMCmk7F72eq3odhel6NxPIQMNNPFGiWL3xmNYOU3k/ebVkgMF+chnfE9ASlbcsmZ/2BEAM8+QOYtJW4Dg4laOCcQalWIcSQLFExmjkCRH1Baf4VapjovR87osQ6zCKfUELjnFBz35ZSV9OJiBzZFnT5YCz0YQs7nJ6lEm8yyvoqP+Wvld0ntdRr6SQRP7cLotJbqPfKR4hey7pVvmuirtPmLYksLziObnmEVXWxjbO2mZ+EkhUUconOTZvH2UooLv2Q5WFu/92+rQ8wVGZsiPFldtzangDZ8QE18v2BSGE3dyAC0gUgjKKupA5OIqcYHRoiU7eA1m1bjQtz1w== Vagrant Key",
      " "
    ]
  },
  "network": {
    "name": "app-vpc",
    "vpc_cidr": "10.0.0.0/16",
    "subnets": [
      {
        "name": "app-subnet",
        "cidr": "10.0.1.0/24",
        "zone": "c"
      }
    ]
  },
  "vm_instances": [
    {
      "name": "bastion-host",
      "role": "bastion",
      "machine_type": "e2-micro",
      "public_ip": true,
      "tags": ["bastion"],
      "port": 22
    },
    {
      "name": "frontend-instance",
      "role": "frontend",
      "machine_type": "e2-small",
      "public_ip": true,
      "tags": ["frontend"],
      "port": 80
    },
    {
      "name": "backend-instance",
      "role": "backend",
      "machine_type": "e2-medium",
      "public_ip": false,
      "tags": ["backend"],
      "port": 8080
    },
    {
      "name": "postgres-db",
      "role": "database",
      "machine_type": "e2-small",
      "public_ip": false,
      "tags": ["postgres"],
      "docker_image": "postgres:15",
      "port": 5432
    }
  ],
  "security_groups": [
    {
      "name": "sg-bastion",
      "description": "Allow SSH to Bastion from anywhere",
      "target_tags": ["bastion"],
      "ingress": [
        { "protocol": "tcp", "port": 22, "source_ranges": ["0.0.0.0/0"] }
      ]
    },
    {
      "name": "sg-frontend-http",
      "description": "Allow HTTP/S to Frontend from anywhere",
      "target_tags": ["frontend"],
      "ingress": [
        { "protocol": "tcp", "port": 80, "source_ranges": ["0.0.0.0/0"] },
        { "protocol": "tcp", "port": 443, "source_ranges": ["0.0.0.0/0"] }
      ]
    },
    {
      "name": "sg-backend-access",
      "description": "Allow traffic from Frontend to Backend",
      "target_tags": ["backend"],
      "ingress": [
        { "protocol": "tcp", "port": 8080, "source_tags": ["frontend"] } 
      ]
    },
    {
      "name": "sg-db-access",
      "description": "Allow traffic from Backend to Postgres",
      "target_tags": ["postgres"],
      "ingress": [
        { "protocol": "tcp", "port": 5432, "source_tags": ["backend"] }
      ]
    },
    {
      "name": "sg-internal-ssh",
      "description": "Allow SSH to all instances ONLY from Bastion",
      "target_tags": ["frontend", "backend", "postgres"],
      "ingress": [
        { "protocol": "tcp", "port": 22, "source_tags": ["bastion"] }
      ]
    }
  ]
}