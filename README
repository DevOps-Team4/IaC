# Project setup and run instructions

This document describes how to run the whole project from scratch on a clean machine.

## Preconditions
You need virtual machines created by our Terrafrom.
If you are working on Windows like me, you will need to install some Linux-based console(WSL).
I used an Ubuntu 24.04 console in my IDE.
Also, you need Terraform and Ansible to be installed.

## SSH key
SSH key also is generated by our Terraform.

## Environment variables for GHCR
You must export GitHub Container Registry credentials locally.

```export GHCR_USER="your-github-username"
export GHCR_TOKEN="your-github-personal-access-token"```

The token must have read:packages permission.

## Clone repository to WSL console
Enter your WSl console and clone the repository like this.

mkdir -p ~/<your-folder-on-WSL>
cd ~/<your-folder-on-WSL>
git clone <your-repo-url> 

OR you can can copy already cloned repo like this 

cp -r /mnt/d/<your-local-folder> ~/<your-folder-on-WSL>
cd <your-folder-on-WSL>/ansible

## Run Ansible
Run the playbook from ansible directory.

ansible-playbook -i inventory.ini playbooks/site.yml --vault-password-file=.vault_pass -v

## Application access
Open browser and go to:
http://WEB_SERVER_IP

Frontend will be served on port 80.
Backend API is available via /api.

Example:
http://WEB_SERVER_IP/api/tutorials

## VM restart behavior
You can stop and start VMs.

Docker containers use restart unless-stopped.
They will start automatically.

Nginx and PostgreSQL are enabled as system services.
They will start after reboot.

If you decide to run "terraform  destroy", IP addresses will be updated so as inventory.ini file.
If you decide to stop VMs manually, you will need to change inventory.ini manually.

## Inventory configuration
This is an example of correct inventory.ini
[bastion-host]
bastion ansible_host=<bastion_ip>

[web-server]
frontend ansible_host=<frontend_ip>

[app-server]
backend ansible_host=<backend_ip>

[postgres-db]
database ansible_host=<postgres_ip>

[all:vars]
ansible_user=provisioning
ansible_ssh_private_key_file=~/.ssh/provisioning_key
ansible_ssh_common_args='-F ~/.ssh/config'
postgres_user=<postgres_user>
postgres_password=<postgres_password>
postgres_db=<postgres_db>
